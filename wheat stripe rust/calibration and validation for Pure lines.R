library("PoPS")
library("doParallel")

use_lethal_temperature <- FALSE
temp <- FALSE
precip <- FALSE
season_month_start <- 1
season_month_end <- 7
time_step <- "month"
start_time <- 2015
end_time <- 2019
lethal_temperature <- -35
lethal_temperature_month <- 1
random_seed <- 42
reproductive_rate <- 2.1
treatments_file <- ""
treatment_years <- c(0)
treatment_month <- 12
treatment_method <- "ratio"
management <- FALSE
mortality_on <- FALSE
mortality_rate <- 0
mortality_time_lag <- 0
percent_natural_dispersal <- 1.0
natural_kernel_type <- "cauchy"
anthropogenic_kernel_type <- "cauchy"
natural_distance_scale <- 29
anthropogenic_distance_scale <- 0.0
natural_dir <- "E"
natural_kappa <- 0.15
anthropogenic_dir <- "NONE"
anthropogenic_kappa <- 0

infected_years_file <- "C:/Users/bhimc/OneDrive/Desktop/Oregon State University/Modeling works_EEID/Across_systems/wheat stripe rust/real_infected for Purelines.tif"
num_iterations <- 10
start_reproductive_rate <- 1.5
start_natural_distance_scale <- 40
sd_reproductive_rate <- 0.2
sd_natural_distance_scale <- 4
number_of_cores <- 3

infected_file <- "C:/Users/bhimc/OneDrive/Desktop/Oregon State University/Modeling works_EEID/Across_systems/wheat stripe rust/Pure_infected.tif"
host_file <- "C:/Users/bhimc/OneDrive/Desktop/Oregon State University/Modeling works_EEID/Across_systems/wheat stripe rust/Pure_host.tif"
total_plants_file <- "C:/Users/bhimc/OneDrive/Desktop/Oregon State University/Modeling works_EEID/Across_systems/wheat stripe rust/Pure_total.tif"
temperature_file <- ""
temperature_coefficient_file <- ""



mask = "C:/Users/bhimc/OneDrive/Desktop/Oregon State University/Modeling works_EEID/Across_systems/wheat stripe rust/mask.tif"
success_metric = "quantity"

params_pure_lines <- calibrate(infected_years_file, num_iterations, start_reproductive_rate, number_of_cores,
                        start_natural_distance_scale, sd_reproductive_rate, sd_natural_distance_scale,
                        infected_file, host_file, total_plants_file, 
                        temp, temperature_coefficient_file, 
                        precip = FALSE, precipitation_coefficient_file, 
                        time_step, reproductive_rate,
                        season_month_start, season_month_end, 
                        start_time, end_time, 
                        use_lethal_temperature, temperature_file,
                        lethal_temperature, lethal_temperature_month,
                        mortality_on, mortality_rate, mortality_time_lag, 
                        management, treatment_years, treatments_file,
                        treatment_method, treatment_month,
                        percent_natural_dispersal = 1.0,
                        natural_kernel_type = "cauchy", anthropogenic_kernel_type = "cauchy",
                        natural_distance_scale = 21, anthropogenic_distance_scale = 0.0,
                        natural_dir = "NONE", natural_kappa = 0, 
                        anthropogenic_dir = "NONE", anthropogenic_kappa = 0,
                        mask, success_metric)






infected_years_file <- "C:/Users/bhimc/OneDrive/Desktop/Oregon State University/Modeling works_EEID/Across_systems/wheat stripe rust/real_infected.tif"
num_iterations <- 10

infected_file <- "C:/Users/bhimc/OneDrive/Desktop/Oregon State University/Modeling works_EEID/Across_systems/wheat stripe rust/mix_infected.tif"
host_file <- "C:/Users/bhimc/OneDrive/Desktop/Oregon State University/Modeling works_EEID/Across_systems/wheat stripe rust/mix_host.tif"
total_plants_file <- "C:/Users/bhimc/OneDrive/Desktop/Oregon State University/Modeling works_EEID/Across_systems/wheat stripe rust/mix_total.tif"
temperature_file <- ""
temperature_coefficient_file <- ""
precipitation_coefficient_file <-""
use_lethal_temperature <- TRUE
temp <- TRUE
precip <- FALSE
season_month_start <- 5
season_month_end <- 11
time_step <- "month"
start_time <- 2018
end_time <- 2018
lethal_temperature <- -35
lethal_temperature_month <- 1
random_seed <- 42
reproductive_rate <- 3.5
treatments_file <- ""
treatment_years <- c(0)
treatment_month <- 12
treatment_method <- "ratio"
management <- FALSE
mortality_on <- FALSE
mortality_rate <- 0
mortality_time_lag <- 0
percent_natural_dispersal <- 1.0
natural_kernel_type <- "cauchy"
anthropogenic_kernel_type <- "cauchy"
natural_distance_scale <- 21
anthropogenic_distance_scale <- 0.0
natural_dir <- "NONE"
natural_kappa <- 0
anthropogenic_dir <- "NONE"
anthropogenic_kappa <- 0

validate_slf <- validate(infected_years_file, num_iterations, number_of_cores,
                         infected_file, host_file, total_plants_file, 
                         temp, temperature_coefficient_file, 
                         precip = FALSE, precipitation_coefficient_file, 
                         time_step, reproductive_rate,
                         season_month_start, season_month_end, 
                         start_time, end_time, 
                         use_lethal_temperature, temperature_file,
                         lethal_temperature, lethal_temperature_month,
                         mortality_on, mortality_rate, mortality_time_lag, 
                         management, treatment_years, treatments_file,
                         treatment_method, treatment_month,
                         percent_natural_dispersal = 1.0,
                         natural_kernel_type = "cauchy", anthropogenic_kernel_type = "cauchy",
                         natural_distance_scale = 21, anthropogenic_distance_scale = 0.0,
                         natural_dir = "NONE", natural_kappa = 0, 
                         anthropogenic_dir = "NONE", anthropogenic_kappa = 0,
                         mask, success_metric)

weather_2005 <- stack("H:/Shared drives/SHIC Projects/test_data/weather_coef_2002_2005.tif")
weather_2005 <- weather_2005[[157:nlayers(weather_2005)]]

cum_inf_2002_2004 <- stack(raster("H:/Shared drives/SHIC Projects/test_data/cum_inf_2002.tif"), raster("H:/Shared drives/SHIC Projects/test_data/cum_inf_2003.tif"),raster("H:/Shared drives/SHIC Projects/test_data/cum_inf_2004.tif"))

writeRaster(cum_inf_2002_2004, "H:/Shared drives/SHIC Projects/test_data/cum_inf_2002_2004.tif")
writeRaster(weather_2005, "H:/Shared drives/SHIC Projects/test_data/weather_2005.tif")